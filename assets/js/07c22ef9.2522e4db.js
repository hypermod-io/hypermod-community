"use strict";(self.webpackChunkcodeshift_community=self.webpackChunkcodeshift_community||[]).push([[9951],{1205:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=n(4848),s=n(8453);const a={id:"understanding-asts",title:"Understanding ASTs",slug:"/understanding-asts",description:"Learn about abstract syntax trees (ASTs) and how they are used in codemods. This page covers the basics of ASTs, including what they are and how they are used to represent the structure of code. We'll also discuss how to read and manipulate ASTs in your codemods to automatically refactor your codebase.",keywords:["abstract syntax trees","ASTs","codemods","refactor","codebase"]},r=void 0,i={id:"guides/understanding-asts",title:"Understanding ASTs",description:"Learn about abstract syntax trees (ASTs) and how they are used in codemods. This page covers the basics of ASTs, including what they are and how they are used to represent the structure of code. We'll also discuss how to read and manipulate ASTs in your codemods to automatically refactor your codebase.",source:"@site/docs/guides/understanding-asts.mdx",sourceDirName:"guides",slug:"/understanding-asts",permalink:"/hypermod-community/docs/understanding-asts",draft:!1,unlisted:!1,editUrl:"https://github.com/hypermod-io/hypermod-community/edit/main/website/docs/guides/understanding-asts.mdx",tags:[],version:"current",frontMatter:{id:"understanding-asts",title:"Understanding ASTs",slug:"/understanding-asts",description:"Learn about abstract syntax trees (ASTs) and how they are used in codemods. This page covers the basics of ASTs, including what they are and how they are used to represent the structure of code. We'll also discuss how to read and manipulate ASTs in your codemods to automatically refactor your codebase.",keywords:["abstract syntax trees","ASTs","codemods","refactor","codebase"]},sidebar:"docs",previous:{title:"Your first codemod",permalink:"/hypermod-community/docs/your-first-codemod"},next:{title:"When not to codemod",permalink:"/hypermod-community/docs/when-not-to-codemod"}},d={},c=[{value:"Abstract Syntax Tree (aka AST)",id:"abstract-syntax-tree-aka-ast",level:2},{value:"AST Explorer",id:"ast-explorer",level:2}];function l(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components},{Head:a}=t;return a||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a,{children:[(0,o.jsx)("title",{children:"Understanding ASTs"}),(0,o.jsx)("link",{rel:"canonical",href:"https://www.hypermod.io/docs/guides/understanding-asts"})]}),"\n",(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsxs)(t.p,{children:["This guide has been moved to a new location. Please visit the new ",(0,o.jsx)(t.a,{href:"https://www.hypermod.io/docs/guides/understanding-asts",children:"Understanding ASTs guide"}),"."]})}),"\n",(0,o.jsx)(t.p,{children:"Before writing your first codemod, it\u2019s important to first have a good conceptual understanding of ASTs (abstract syntax trees) and how to work with them."}),"\n",(0,o.jsx)(t.h2,{id:"abstract-syntax-tree-aka-ast",children:"Abstract Syntax Tree (aka AST)"}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsx)(t.p,{children:"An abstract syntax tree (AST), is a tree representation of the abstract syntactic structure of source code written in a programming language. Each node of the tree denotes a construct occurring in the source code."}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["\u2013 ",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Abstract_syntax_tree",children:"Wiki: Abstract syntax tree"})]}),"\n",(0,o.jsxs)(t.p,{children:["Abstract Syntax Trees can be thought of as simply the object representation of your code after being parsed.\nYou might already be familiar with the tools and libraries that do this, for example ",(0,o.jsx)(t.a,{href:"https://babeljs.io/",children:"babeljs"}),", ",(0,o.jsx)(t.a,{href:"https://github.com/benjamn/recast",children:"recast"}),", ",(0,o.jsx)(t.a,{href:"https://eslint.org/",children:"eslint"}),' etc.\nThese tools parse files into ASTs in preparation for some work, which generally consists of breaking a raw file down into "Nodes" which are then organized and categorized into a hierarchial format that can be reasoned about, manipulated and output back into a file.']}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Code \u2014 AST \u2014 AST(mutated) \u2014 Code",src:n(1385).A+"",width:"4000",height:"950"})}),"\n",(0,o.jsxs)(t.p,{children:["\u2013 ",(0,o.jsx)(t.a,{href:"https://itnext.io/automatic-refactoring-with-jscodeshift-codemods-45c219eaf992",children:"Image source"})]}),"\n",(0,o.jsx)(t.p,{children:"Not all ASTs are the same, different libraries like babel and recast structure their ASTs differently, but if you're comfortable with one it's not too hard to wrap your head around another."}),"\n",(0,o.jsx)(t.p,{children:"For instance, consider this snippet:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-jsx",children:"console.log('Hello, World');\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The way you might categorise the anatomy of this expression in your mind is probably not too dissimilar to how it's actually done in ",(0,o.jsx)(t.a,{href:"https://github.com/benjamn/recast",children:"recast"})," (which is what is used in this project).\nSo now compare it to the actual resulting AST, generated by recast."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"const AST = {\n  type: 'File',\n  program: {\n    type: 'Program',\n    sourceType: 'module',\n    body: [\n      {\n        type: 'ExpressionStatement',\n        expression: {\n          type: 'CallExpression',\n          callee: {\n            type: 'MemberExpression',\n            object: {\n              type: 'Identifier',\n              name: 'console',\n            },\n            computed: false,\n            property: {\n              type: 'Identifier',\n              name: 'log',\n            },\n          },\n          arguments: [\n            {\n              type: 'StringLiteral',\n              extra: {\n                rawValue: 'Hello, World',\n                raw: \"'Hello, World'\",\n              },\n              value: 'Hello, World',\n            },\n          ],\n        },\n      },\n    ],\n  },\n};\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Now your initial reaction might be \"wow that's a lot for a simple console.log\" and that's a totally fair assessment. But look a little closer and you should start to see some order among the chaos.\nEvery ",(0,o.jsx)(t.a,{href:"/docs/glossary#node",children:"Node"}),' in this tree is given a "type", these types are key to how you navigate and interact with this object.']}),"\n",(0,o.jsxs)(t.p,{children:["So for example, if you want to know the arguments this method contains, you could first look at the ",(0,o.jsx)(t.code,{children:"arguments"})," property on the ",(0,o.jsx)(t.code,{children:"ExpressionStatement"}),".\nArguments in functions can be conceptually thought of as arrays, so it's no surprise that we're presented with an array here.\nNow we can see that in our array we have one element, which is of the type ",(0,o.jsx)(t.code,{children:"StringLiteral"})," and has its own metadata attached to it containing the value we're looking for: ",(0,o.jsx)(t.code,{children:"Hello, World"})," \u2013 Hooray \ud83c\udf89."]}),"\n",(0,o.jsxs)(t.p,{children:["Great but where do we go from here? Well it totally depends on what you're trying to achieve.\nIf you want to replace the message that's logged, all you'd have to do is replace the ",(0,o.jsx)(t.code,{children:"StringLiteral"})," node with one containing the appropriate message.\nIf you want to pass an additional argument to the method, you could simply push a new node into the arguments array and so on."]}),"\n",(0,o.jsx)(t.p,{children:"The point is, with this abstract data structure we can inspect and manipulate it into any shape we want! A perfect tool for us codemoders!"}),"\n",(0,o.jsx)(t.h2,{id:"ast-explorer",children:"AST Explorer"}),"\n",(0,o.jsx)(t.p,{children:"ASTs, like in the example above, can get quite large, so you could imagine how big one for a typical javascript source file could get \ud83d\ude31!\nHow can one make sense of it all? Well luckily there are indispensable tools out there to help..."}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://astexplorer.net/",children:"astexplorer.net"})," is one of those tools."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"AST Explorer screenshot",src:n(584).A+"",width:"3688",height:"2228"})}),"\n",(0,o.jsx)(t.p,{children:"It provides a real-time representation of your code as an AST which is inspectable and lets you write and test transforms against it live in the browser.\nIt also supports other ASTs like babel, typescript etc. so for our use-case we'll need to configure it a bit to support recast + jscodeshift."}),"\n",(0,o.jsx)(t.p,{children:"To configure it, follow these steps:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Set language to Javascript"}),"\n",(0,o.jsxs)(t.li,{children:["Set the transformer to ",(0,o.jsx)(t.code,{children:"recast"})]}),"\n",(0,o.jsxs)(t.li,{children:["If you want to enable typescript support, click the little cog icon and set the parser to ",(0,o.jsx)(t.code,{children:"TypeScript"})]}),"\n",(0,o.jsx)(t.li,{children:'And finally turn the "transform" toggle on, this should show some new panels to write and test your transforms.'}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["And there you go, you're all setup with a sandbox to help you test/learn/experiment with!\nFrom here you should have enough of a grasp of ASTs to try your hand at ",(0,o.jsx)(t.a,{href:"/docs/your-first-codemod",children:"writing your first codemod"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},1385:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/ast-f6b2404fe976ce54f4d4d5e9e29007cb.png"},584:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/astexplorer-845e0c64d8ddc8aed2cfe5b5900e69e8.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>i});var o=n(6540);const s={},a=o.createContext(s);function r(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);